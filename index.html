<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Google Sheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        pre {
            background-color: #1f2937; /* Darker background for code/JSON */
            color: #e5e7eb; /* Light text color */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto; /* Allow horizontal scrolling for long lines */
            white-space: pre-wrap; /* Wrap long lines */
            word-wrap: break-word; /* Break words if necessary */
        }
        /* Estilos adicionales para la tabla si es necesario */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0; /* light-gray border */
        }
        th {
            background-color: #f8fafc; /* Lighter background for headers */
            font-weight: 600;
            color: #475569; /* Slate 600 */
        }
        tr:hover {
            background-color: #f1f5f9; /* Even lighter hover effect */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-4xl"> <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Consulta de Datos de Google Sheets</h1>

        <div class="mb-6 flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
            <label for="sheetId" class="text-lg font-medium text-gray-700">Selecciona ID de Hoja:</label>
            <select id="sheetId" class="mt-1 block w-full sm:w-auto p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-base">
                <option value="1">Hoja de Cálculo ID 1</option>
                <option value="2">Hoja de Cálculo ID 2</option>
            </select>
            <button id="fetchDataBtn" class="mt-4 sm:mt-0 px-6 py-3 bg-blue-600 text-white font-semibold rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                Obtener Datos
            </button>
        </div>

        <div id="loadingIndicator" class="text-center text-blue-600 text-lg font-medium hidden mb-4">
            Cargando datos...
        </div>

        <div id="results" class="mt-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Resultados:</h2>
            <div id="tableContainer" class="overflow-x-auto">
                <p id="dataMessage" class="text-gray-600">Selecciona una hoja y haz clic en "Obtener Datos".</p>
            </div>
            <pre id="dataDisplay" class="min-h-[150px] hidden mt-4"></pre>
        </div>
    </div>

    <script>
        // Get references to HTML elements
        const sheetIdSelect = document.getElementById('sheetId');
        const fetchDataBtn = document.getElementById('fetchDataBtn');
        const tableContainer = document.getElementById('tableContainer'); // Nuevo contenedor para la tabla
        const dataDisplay = document.getElementById('dataDisplay'); // Para JSON crudo y errores
        const dataMessage = document.getElementById('dataMessage'); // Mensaje inicial
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Base URL for your API
        // IMPORTANT: Replace this with your actual deployed API URL
        const API_BASE_URL = 'https://api-consulta-sismed.googlesites.cloud';

        // Function to fetch data from the API
        async function fetchData() {
            const selectedId = sheetIdSelect.value;
            const apiUrl = `${API_BASE_URL}/leer-sheet?id=${selectedId}`;

            tableContainer.innerHTML = ''; // Clear previous table
            dataDisplay.textContent = ''; // Clear previous JSON
            dataDisplay.classList.add('hidden'); // Ocultar el pre por defecto
            dataMessage.classList.add('hidden'); // Ocultar el mensaje inicial
            loadingIndicator.classList.remove('hidden'); // Show loading indicator

            try {
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || `HTTP error! status: ${response.status} - ${errorData.message}`); // Usar errorData.message si está disponible
                }

                const data = await response.json(); // Parse the JSON response

                if (data.valores && data.valores.length > 0) {
                    const headers = data.valores[0]; // First array in valores is headers
                    const rows = data.valores.slice(1); // Rest are data rows

                    const table = document.createElement('table');
                    table.classList.add('min-w-full', 'bg-white', 'shadow-md', 'rounded-lg', 'overflow-hidden'); // Tailwind classes for table

                    // Create table header
                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    headers.forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText;
                        th.classList.add('py-3', 'px-4', 'border-b', 'border-gray-200', 'bg-gray-50', 'text-sm', 'font-semibold', 'text-gray-600', 'uppercase', 'tracking-wider'); // Tailwind classes for th
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    // Create table body
                    const tbody = document.createElement('tbody');
                    rows.forEach(rowData => {
                        const tr = document.createElement('tr');
                        tr.classList.add('hover:bg-gray-50'); // Tailwind hover effect
                        rowData.forEach(cellData => {
                            const td = document.createElement('td');
                            td.textContent = cellData;
                            td.classList.add('py-3', 'px-4', 'border-b', 'border-gray-200', 'text-sm', 'text-gray-800', 'whitespace-nowrap'); // Tailwind classes for td
                            tr.appendChild(td);
                        });
                        tbody.appendChild(tr);
                    });
                    table.appendChild(tbody);

                    tableContainer.appendChild(table); // Add the table to the container
                    // Optional: Display the success message from the API
                    // dataMessage.textContent = data.message;
                    // dataMessage.classList.remove('hidden');

                } else {
                    dataDisplay.textContent = 'No se encontraron datos o la estructura no es la esperada.';
                    dataDisplay.classList.remove('hidden');
                    dataDisplay.style.color = '#ef4444'; // Red color for errors
                }

            } catch (error) {
                dataDisplay.textContent = `Error al obtener los datos: \n${error.message}`;
                dataDisplay.classList.remove('hidden');
                dataDisplay.style.color = '#ef4444'; // Red color for errors
                console.error('Error fetching data:', error);
            } finally {
                loadingIndicator.classList.add('hidden'); // Hide loading indicator
            }
        }

        // Add event listener to the button
        fetchDataBtn.addEventListener('click', fetchData);

        // Optional: Fetch data automatically on page load for the default selected ID
        // fetchData(); // Descomenta si quieres que cargue al inicio
    </script>
</body>
</html>